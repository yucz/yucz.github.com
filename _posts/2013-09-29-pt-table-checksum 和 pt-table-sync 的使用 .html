---
layout: default
title: pt-table-checksum 和 pt-table-sync 的使用 
description: pt-table-checksum 和 pt-table-sync 的使用 
categories: [mysql]
tags: [percona]
---

<div class="bct fc05 fc11 nbw-blog ztag"><div><b><font size="5">pt-table-checksum测试</font></b></div><div><p></p><div><pre class="prettyprint" style="line-height: 22px;"><div style="line-height: 22px;"><span class="pun">库一致的情况下</span></div><div style="line-height: 22px;"><br style="line-height: 22px;"></div><div style="line-height: 22px;"><span class="pun">./</span><span class="pln">pt</span><span class="pun">-</span><span class="pln">table</span><span class="pun">-</span><span class="pln">checksum h</span><span class="pun">=</span><span class="str">'127.0.0.1'</span><span class="pun">,</span><span class="pln">u</span><span class="pun">=</span><span class="str">'root'</span><span class="pun">,</span><span class="pln">p</span><span class="pun">=</span><span class="str">'dh123'</span><span class="pun">,</span><span class="pln">P</span><span class="pun">=</span><span class="lit">5331</span><span class="pln"> </span><span class="pun">-</span><span class="pln">d db1 </span><span class="pun">--</span><span class="pln">recursion</span><span class="pun">-</span><span class="pln">method</span><span class="pun">=</span><span class="pln">processlist </span><span class="pun">--</span><span class="kwd">no</span><span class="pun">-</span><span class="pln">check</span><span class="pun">-</span><span class="pln">binlog</span><span class="pun">-</span><span class="pln">format </span><span class="pun">--</span><span class="pln">replicate</span><span class="pun">=</span><span class="pln">test</span><span class="pun">.</span><span class="pln">checksums</span></div><div style="line-height: 22px;"><br style="line-height: 22px;"></div><div style="line-height: 22px;"><span class="pln">SELECT db</span><span class="pun">,</span><span class="pln"> tbl</span><span class="pun">,</span><span class="pln">lower_boundary</span><span class="pun">,</span><span class="pln">upper_boundary</span><span class="pun">,</span><span class="pln"> this_cnt</span><span class="pun">,</span><span class="pln">master_cnt</span><span class="pun">,</span><span class="pln">this_crc</span><span class="pun">,</span><span class="pln">master_crc</span><span class="pun">,</span><span class="pln">ts FROM test</span><span class="pun">.</span><span class="pln">checksums </span><span class="pun">;</span></div><div style="line-height: 22px;"><span class="pun">+-----+--------+----------------+----------------+----------+------------+----------+------------+---------------------+</span></div><div style="line-height: 22px;"><span class="pun">|</span><span class="pln"> db &nbsp;</span><span class="pun">|</span><span class="pln"> tbl &nbsp; &nbsp;</span><span class="pun">|</span><span class="pln"> lower_boundary </span><span class="pun">|</span><span class="pln"> upper_boundary </span><span class="pun">|</span><span class="pln"> this_cnt </span><span class="pun">|</span><span class="pln"> master_cnt </span><span class="pun">|</span><span class="pln"> this_crc </span><span class="pun">|</span><span class="pln"> master_crc </span><span class="pun">|</span><span class="pln"> ts &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">|</span></div><div style="line-height: 22px;"><span class="pun">+-----+--------+----------------+----------------+----------+------------+----------+------------+---------------------+</span></div><div style="line-height: 22px;"><span class="pun">|</span><span class="pln"> db1 </span><span class="pun">|</span><span class="pln"> tab1_1 </span><span class="pun">|</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">|</span><span class="pln"> </span><span class="lit">999</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">|</span><span class="pln"> &nbsp; &nbsp; </span><span class="lit">1000</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> &nbsp; &nbsp; &nbsp; </span><span class="lit">1000</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> dbd114dd </span><span class="pun">|</span><span class="pln"> dbd114dd &nbsp; </span><span class="pun">|</span><span class="pln"> </span><span class="lit">2013</span><span class="pun">-</span><span class="lit">06</span><span class="pun">-</span><span class="lit">25</span><span class="pln"> </span><span class="lit">13</span><span class="pun">:</span><span class="lit">02</span><span class="pun">:</span><span class="lit">37</span><span class="pln"> </span><span class="pun">|</span></div><div style="line-height: 22px;"><span class="pun">|</span><span class="pln"> db1 </span><span class="pun">|</span><span class="pln"> tab1_1 </span><span class="pun">|</span><span class="pln"> </span><span class="lit">1000</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">|</span><span class="pln"> </span><span class="lit">9999</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">|</span><span class="pln"> &nbsp; &nbsp; </span><span class="lit">9000</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> &nbsp; &nbsp; &nbsp; </span><span class="lit">9000</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">|</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">|</span><span class="pln"> </span><span class="lit">2013</span><span class="pun">-</span><span class="lit">06</span><span class="pun">-</span><span class="lit">25</span><span class="pln"> </span><span class="lit">13</span><span class="pun">:</span><span class="lit">02</span><span class="pun">:</span><span class="lit">37</span><span class="pln"> </span><span class="pun">|</span></div><div style="line-height: 22px;"><span class="pun">|</span><span class="pln"> db1 </span><span class="pun">|</span><span class="pln"> tab1_1 </span><span class="pun">|</span><span class="pln"> NULL &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">|</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">|</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="lit">0</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="lit">0</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">|</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">|</span><span class="pln"> </span><span class="lit">2013</span><span class="pun">-</span><span class="lit">06</span><span class="pun">-</span><span class="lit">25</span><span class="pln"> </span><span class="lit">13</span><span class="pun">:</span><span class="lit">02</span><span class="pun">:</span><span class="lit">37</span><span class="pln"> </span><span class="pun">|</span></div><div style="line-height: 22px;"><span class="pun">|</span><span class="pln"> db1 </span><span class="pun">|</span><span class="pln"> tab1_1 </span><span class="pun">|</span><span class="pln"> </span><span class="lit">9999</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">|</span><span class="pln"> NULL &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">|</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="lit">0</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="lit">0</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">|</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">|</span><span class="pln"> </span><span class="lit">2013</span><span class="pun">-</span><span class="lit">06</span><span class="pun">-</span><span class="lit">25</span><span class="pln"> </span><span class="lit">13</span><span class="pun">:</span><span class="lit">02</span><span class="pun">:</span><span class="lit">37</span><span class="pln"> </span><span class="pun">|</span></div><div style="line-height: 22px;"><span class="pun">|</span><span class="pln"> db1 </span><span class="pun">|</span><span class="pln"> tab1_2 </span><span class="pun">|</span><span class="pln"> NULL &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">|</span><span class="pln"> NULL &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">|</span><span class="pln"> &nbsp; &nbsp; </span><span class="lit">1000</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> &nbsp; &nbsp; &nbsp; </span><span class="lit">1000</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> dbd114dd </span><span class="pun">|</span><span class="pln"> dbd114dd &nbsp; </span><span class="pun">|</span><span class="pln"> </span><span class="lit">2013</span><span class="pun">-</span><span class="lit">06</span><span class="pun">-</span><span class="lit">25</span><span class="pln"> </span><span class="lit">13</span><span class="pun">:</span><span class="lit">02</span><span class="pun">:</span><span class="lit">37</span><span class="pln"> </span><span class="pun">|</span></div><div style="line-height: 22px;"><span class="pun">+-----+--------+----------------+----------------+----------+------------+----------+------------+---------------------+</span></div><div><br></div></pre></div><div><pre class="prettyprint" style="line-height: 22px;"><div style="line-height: 22px;"><span class="pun">库不一致的情况下</span></div><div style="line-height: 22px;"><span class="pln">slave&nbsp;</span></div><div style="line-height: 22px;"><span class="kwd">delete</span><span class="pln"> </span><span class="kwd">from</span><span class="pln"> tab1_2 </span><span class="pun">;</span></div><div style="line-height: 22px;"><br style="line-height: 22px;"></div><div style="line-height: 22px;"><br style="line-height: 22px;"></div><div style="line-height: 22px;"><span class="pun">./</span><span class="pln">pt</span><span class="pun">-</span><span class="pln">table</span><span class="pun">-</span><span class="pln">checksum h</span><span class="pun">=</span><span class="str">'127.0.0.1'</span><span class="pun">,</span><span class="pln">u</span><span class="pun">=</span><span class="str">'root'</span><span class="pun">,</span><span class="pln">p</span><span class="pun">=</span><span class="str">'dh123'</span><span class="pun">,</span><span class="pln">P</span><span class="pun">=</span><span class="lit">5331</span><span class="pln"> </span><span class="pun">-</span><span class="pln">d db1 </span><span class="pun">--</span><span class="pln">recursion</span><span class="pun">-</span><span class="pln">method</span><span class="pun">=</span><span class="pln">processlist </span><span class="pun">--</span><span class="kwd">no</span><span class="pun">-</span><span class="pln">check</span><span class="pun">-</span><span class="pln">binlog</span><span class="pun">-</span><span class="pln">format </span><span class="pun">--</span><span class="pln">replicate</span><span class="pun">=</span><span class="pln">test</span><span class="pun">.</span><span class="pln">checksums</span></div><div style="line-height: 22px;"><span class="pln">SELECT db</span><span class="pun">,</span><span class="pln"> tbl</span><span class="pun">,</span><span class="pln">lower_boundary</span><span class="pun">,</span><span class="pln">upper_boundary</span><span class="pun">,</span><span class="pln"> this_cnt</span><span class="pun">,</span><span class="pln">master_cnt</span><span class="pun">,</span><span class="pln">this_crc</span><span class="pun">,</span><span class="pln">master_crc</span><span class="pun">,</span><span class="pln">ts FROM test</span><span class="pun">.</span><span class="pln">checksums </span><span class="pun">;</span></div><div style="line-height: 22px;"><span class="pun">+-----+--------+----------------+----------------+----------+------------+----------+------------+---------------------+</span></div><div style="line-height: 22px;"><span class="pun">|</span><span class="pln"> db &nbsp;</span><span class="pun">|</span><span class="pln"> tbl &nbsp; &nbsp;</span><span class="pun">|</span><span class="pln"> lower_boundary </span><span class="pun">|</span><span class="pln"> upper_boundary </span><span class="pun">|</span><span class="pln"> this_cnt </span><span class="pun">|</span><span class="pln"> master_cnt </span><span class="pun">|</span><span class="pln"> this_crc </span><span class="pun">|</span><span class="pln"> master_crc </span><span class="pun">|</span><span class="pln"> ts &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">|</span></div><div style="line-height: 22px;"><span class="pun">+-----+--------+----------------+----------------+----------+------------+----------+------------+---------------------+</span></div><div style="line-height: 22px;"><span class="pun">|</span><span class="pln"> db1 </span><span class="pun">|</span><span class="pln"> tab1_1 </span><span class="pun">|</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">|</span><span class="pln"> </span><span class="lit">999</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">|</span><span class="pln"> &nbsp; &nbsp; </span><span class="lit">1000</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> &nbsp; &nbsp; &nbsp; </span><span class="lit">1000</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> dbd114dd </span><span class="pun">|</span><span class="pln"> dbd114dd &nbsp; </span><span class="pun">|</span><span class="pln"> </span><span class="lit">2013</span><span class="pun">-</span><span class="lit">06</span><span class="pun">-</span><span class="lit">25</span><span class="pln"> </span><span class="lit">13</span><span class="pun">:</span><span class="lit">05</span><span class="pun">:</span><span class="lit">29</span><span class="pln"> </span><span class="pun">|</span></div><div style="line-height: 22px;"><span class="pun">|</span><span class="pln"> db1 </span><span class="pun">|</span><span class="pln"> tab1_1 </span><span class="pun">|</span><span class="pln"> </span><span class="lit">1000</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">|</span><span class="pln"> </span><span class="lit">9999</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">|</span><span class="pln"> &nbsp; &nbsp; </span><span class="lit">9000</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> &nbsp; &nbsp; &nbsp; </span><span class="lit">9000</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">|</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">|</span><span class="pln"> </span><span class="lit">2013</span><span class="pun">-</span><span class="lit">06</span><span class="pun">-</span><span class="lit">25</span><span class="pln"> </span><span class="lit">13</span><span class="pun">:</span><span class="lit">05</span><span class="pun">:</span><span class="lit">29</span><span class="pln"> </span><span class="pun">|</span></div><div style="line-height: 22px;"><span class="pun">|</span><span class="pln"> db1 </span><span class="pun">|</span><span class="pln"> tab1_1 </span><span class="pun">|</span><span class="pln"> NULL &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">|</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">|</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="lit">0</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="lit">0</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">|</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">|</span><span class="pln"> </span><span class="lit">2013</span><span class="pun">-</span><span class="lit">06</span><span class="pun">-</span><span class="lit">25</span><span class="pln"> </span><span class="lit">13</span><span class="pun">:</span><span class="lit">05</span><span class="pun">:</span><span class="lit">29</span><span class="pln"> </span><span class="pun">|</span></div><div style="line-height: 22px;"><span class="pun">|</span><span class="pln"> db1 </span><span class="pun">|</span><span class="pln"> tab1_1 </span><span class="pun">|</span><span class="pln"> </span><span class="lit">9999</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">|</span><span class="pln"> NULL &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">|</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="lit">0</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="lit">0</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">|</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">|</span><span class="pln"> </span><span class="lit">2013</span><span class="pun">-</span><span class="lit">06</span><span class="pun">-</span><span class="lit">25</span><span class="pln"> </span><span class="lit">13</span><span class="pun">:</span><span class="lit">05</span><span class="pun">:</span><span class="lit">29</span><span class="pln"> </span><span class="pun">|</span></div><div style="line-height: 22px;"><span class="pun">|</span><span class="pln"> db1 </span><span class="pun">|</span><span class="pln"> tab1_2 </span><span class="pun">|</span><span class="pln"> NULL &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">|</span><span class="pln"> NULL &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">|</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="lit">0</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> &nbsp; &nbsp; &nbsp; </span><span class="lit">1000</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">|</span><span class="pln"> dbd114dd &nbsp; </span><span class="pun">|</span><span class="pln"> </span><span class="lit">2013</span><span class="pun">-</span><span class="lit">06</span><span class="pun">-</span><span class="lit">25</span><span class="pln"> </span><span class="lit">13</span><span class="pun">:</span><span class="lit">05</span><span class="pun">:</span><span class="lit">30</span><span class="pln"> </span><span class="pun">|</span></div><div style="line-height: 22px;"><span class="pun">+-----+--------+----------------+----------------+----------+------------+----------+------------+---------------------+</span></div><div style="line-height: 22px;"><br style="line-height: 22px;"></div></pre></div><div><pre class="prettyprint" style="line-height: 22px;"><div style="line-height: 22px;"><span class="pun">常用的参数解释</span></div><div style="line-height: 22px;"><br style="line-height: 22px;"></div><div style="line-height: 22px;"><span class="pun">--</span><span class="pln">check</span><span class="pun">-</span><span class="pln">replication</span><span class="pun">-</span><span class="pln">filters </span><span class="pun">检查复制中是否设置了过滤条件，如果设置了，程序将退出。可以使用--</span><span class="kwd">no</span><span class="pun">-</span><span class="pln">check</span><span class="pun">-</span><span class="pln">replication</span><span class="pun">-</span><span class="pln">filters</span><span class="pun">禁用</span></div><div style="line-height: 22px;"><span class="pun">--</span><span class="pln">recursion</span><span class="pun">-</span><span class="pln">method </span><span class="pun">发现</span><span class="pln">slave</span><span class="pun">使用的方式</span><span class="pln"> </span><span class="pun">通常使用</span><span class="pln"> processlist </span><span class="pun">，或者手动指定</span><span class="pln">dsn</span></div><div style="line-height: 22px;"><span class="pun">--</span><span class="pln">max</span><span class="pun">-</span><span class="pln">lag </span><span class="pun">只有当复制的延迟小于这个范围的时候，才开始检查一致性，否则暂停</span></div><div style="line-height: 22px;"><span class="pun">--</span><span class="pln">explain </span><span class="pun">只显示</span><span class="pln">checksum</span><span class="pun">的查询语句，但是不执行，对于理解</span><span class="pln">checksum</span><span class="pun">非常有用。</span></div><div style="line-height: 22px;"><span class="pun">--</span><span class="pln">chunk</span><span class="pun">-</span><span class="pln">time </span><span class="pun">调整</span><span class="pln">chunk</span><span class="pun">的大小，似的每次</span><span class="pln">chunk</span><span class="pun">的执行时间小于这个值</span></div><div style="line-height: 22px;"><span class="pun">--</span><span class="kwd">no</span><span class="pun">-</span><span class="pln">check</span><span class="pun">-</span><span class="pln">binlog</span><span class="pun">-</span><span class="pln">format </span><span class="pun">不对</span><span class="pln">binlog</span><span class="pun">的格式进行检查</span></div><div style="line-height: 22px;"><br style="line-height: 22px;"></div><div style="line-height: 22px;"><span class="pun">查询哪些表的结果是不一致的</span><span class="pln">sql</span></div><div style="line-height: 22px;"><span class="pln">SELECT db</span><span class="pun">,</span><span class="pln"> tbl</span><span class="pun">,</span><span class="pln"> SUM</span><span class="pun">(</span><span class="pln">this_cnt</span><span class="pun">)</span><span class="pln"> AS total_rows</span><span class="pun">,</span><span class="pln"> COUNT</span><span class="pun">(*)</span><span class="pln"> AS chunks FROM test</span><span class="pun">.</span><span class="pln">checksums WHERE </span><span class="pun">(</span><span class="pln"> master_cnt </span><span class="pun">&lt;&gt;</span><span class="pln"> this_cnt OR master_crc </span><span class="pun">&lt;&gt;</span><span class="pln"> this_crc OR ISNULL</span><span class="pun">(</span><span class="pln">master_crc</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;&gt;</span><span class="pln"> ISNULL</span><span class="pun">(</span><span class="pln">this_crc</span><span class="pun">))</span><span class="pln"> GROUP BY db</span><span class="pun">,</span><span class="pln"> tbl</span><span class="pun">;</span></div><div><br></div></pre></div><div><br></div><div><pre class="prettyprint" style="line-height: 22px;"><div style="line-height: 22px;"><span class="pun">常见的错误及其解决方法</span></div><div style="line-height: 22px;"><br style="line-height: 22px;"></div><div style="line-height: 22px;"><span class="typ">Diffs</span><span class="pln"> cannot be detected because </span><span class="kwd">no</span><span class="pln"> slaves were found</span><span class="pun">.</span><span class="pln"> &nbsp;</span><span class="typ">Please</span><span class="pln"> read the </span><span class="pun">--</span><span class="pln">recursion</span><span class="pun">-</span><span class="pln">method documentation </span><span class="kwd">for</span><span class="pln"> information</span><span class="pun">.</span></div><div style="line-height: 22px;"><span class="pun">是指找不到</span><span class="pln">slave</span><span class="pun">，检查可能会无效。需要指定</span><span class="pln"> </span><span class="pun">--</span><span class="pln">recursion</span><span class="pun">-</span><span class="pln">method</span><span class="pun">=</span><span class="pln">processlist</span></div><div style="line-height: 22px;"><br style="line-height: 22px;"></div><div style="line-height: 22px;"><br style="line-height: 22px;"></div><div style="line-height: 22px;"><span class="typ">Replica</span><span class="pln"> centos</span><span class="pun">-</span><span class="lit">1</span><span class="pln"> has binlog_format ROW which could cause pt</span><span class="pun">-</span><span class="pln">table</span><span class="pun">-</span><span class="pln">checksum to </span><span class="kwd">break</span><span class="pln"> replication</span><span class="pun">.</span><span class="pln"> &nbsp;</span><span class="typ">Please</span><span class="pln"> read </span><span class="str">"Replicas using row-based replication"</span><span class="pln"> </span><span class="kwd">in</span><span class="pln"> the LIMITATIONS section of the tool</span><span class="str">'s documentation. &nbsp;If you understand the risks, specify --no-check-binlog-format to disable this check.</span></div><div style="line-height: 22px;"><span class="str">指定--no-check-binlog-format跳过binlog format的检查</span></div><div style="line-height: 22px;"><br style="line-height: 22px;"></div><div style="line-height: 22px;"><br style="line-height: 22px;"></div><div style="line-height: 22px;"><span class="str">06-25T13:01:11 Cannot checksum table test.t: There is no good index and the table is oversized. at ./pt-table-checksum line 6370.</span></div><div style="line-height: 22px;"><span class="str">表上没有主键或者唯一索引</span></div><div style="line-height: 22px;"><br style="line-height: 22px;"></div><div style="line-height: 22px;"><span class="str">06-25T13:08:44 --replicate table `test`.`checksums` does not exist and --no-create-replicate-table was specified. &nbsp;You need to create the table.</span></div><div style="line-height: 22px;"><span class="str">replicate 表不存在的情况下，不能指定--no-create-replicate-table。</span></div><div style="line-height: 22px;"><span class="str">指定了 --replicate-check-only 的情况下，也需要replicate 表存在。</span></div><div><br></div></pre></div><div><br></div><div></div><p></p></div><div><br></div><div><span style="line-height: 22px;"><font size="5"><b>pt-table-sync的测试</b></font></span></div><div><p></p><div><font size="2">在数据不一致的情况下，使用pt-table-sync同步数据</font></div><div><font size="2"><br></font></div><div><pre class="prettyprint" style="line-height: 22px;"><div style="line-height: 22px;"><font size="2" style="line-height: 19px;"><span class="pun">没有复制关系的两个实例之间同步数据</span></font></div><div style="line-height: 22px;"><font size="2" style="line-height: 19px;"><span class="pun">./</span><span class="pln">pt</span><span class="pun">-</span><span class="pln">table</span><span class="pun">-</span><span class="pln">sync </span><span class="pun">--</span><span class="pln">execute h</span><span class="pun">=</span><span class="str">'127.0.0.1'</span><span class="pun">,</span><span class="pln">u</span><span class="pun">=</span><span class="str">'root'</span><span class="pun">,</span><span class="pln">p</span><span class="pun">=</span><span class="str">'dh123'</span><span class="pun">,</span><span class="pln">P</span><span class="pun">=</span><span class="lit">5331</span><span class="pln"> h</span><span class="pun">=</span><span class="str">'192.168.12.201'</span><span class="pun">,</span><span class="pln">u</span><span class="pun">=</span><span class="str">'root'</span><span class="pun">,</span><span class="pln">p</span><span class="pun">=</span><span class="str">'dh123'</span><span class="pun">,</span><span class="pln">P</span><span class="pun">=</span><span class="lit">5332</span><span class="pln"> </span><span class="pun">--</span><span class="pln">database db1&nbsp;</span></font></div><div><font size="2" style="line-height: 19px;"><br></font></div></pre></div><div><font size="2"><br></font></div><div><pre class="prettyprint" style="line-height: 22px;"><div style="line-height: 22px;"><font size="2" style="line-height: 19px;"><span class="pun">连接到</span><span class="pln">master</span><span class="pun">上，同步所有</span><span class="pln">checksums</span><span class="pun">发现的不一致的</span><span class="pln">slave</span><span class="pun">数据</span></font></div><div style="line-height: 22px;"><font size="2" style="line-height: 19px;"><span class="pln">pt</span><span class="pun">-</span><span class="pln">table</span><span class="pun">-</span><span class="pln">sync </span><span class="pun">--</span><span class="pln">execute </span><span class="pun">--</span><span class="pln">replicate test</span><span class="pun">.</span><span class="pln">checksums h</span><span class="pun">=</span><span class="str">'127.0.0.1'</span><span class="pun">,</span><span class="pln">u</span><span class="pun">=</span><span class="str">'root'</span><span class="pun">,</span><span class="pln">p</span><span class="pun">=</span><span class="str">'dh123'</span><span class="pun">,</span><span class="pln">P</span><span class="pun">=</span><span class="lit">5331</span><span class="pun">,</span><span class="pln">D</span><span class="pun">=</span><span class="pln">db1</span><span class="pun">,</span><span class="pln">t</span><span class="pun">=</span><span class="pln">tab1_2</span></font></div></pre></div><div><br></div><div><pre class="prettyprint" style="line-height: 22px;"><div style="line-height: 22px;"><font size="2" style="line-height: 19px;"><span class="pun">连接到</span><span class="pln">slave</span><span class="pun">上，执行同步</span><span class="pln">master</span><span class="pun">上的数据操作</span></font></div><div style="line-height: 22px;"><font size="2" style="line-height: 19px;"><span class="pun">[</span><span class="pln">root@centos</span><span class="pun">-</span><span class="lit">1</span><span class="pln"> bin</span><span class="pun">]</span><span class="com"># ./pt-table-sync --execute --sync-to-master h='127.0.0.1',u='root',p='dh123',P=5331 -d db1 --verbose&nbsp;</span></font></div><div style="line-height: 22px;"><font size="2" style="line-height: 19px;"><span class="com"># Syncing P=5331,h=127.0.0.1,p=...,u=root</span></font></div><div style="line-height: 22px;"><font size="2" style="line-height: 19px;"><span class="com"># DELETE REPLACE INSERT UPDATE ALGORITHM START &nbsp; &nbsp;END &nbsp; &nbsp; &nbsp;EXIT DATABASE.TABLE</span></font></div><div style="line-height: 22px;"><font size="2" style="line-height: 19px;"><span class="com"># &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0 Chunk &nbsp; &nbsp; 14:04:31 14:04:31 0 &nbsp; &nbsp;db1.tab1_1</span></font></div><div style="line-height: 22px;"><font size="2" style="line-height: 19px;"><span class="com"># &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp;1000 &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0 Chunk &nbsp; &nbsp; 14:04:31 14:04:32 2 &nbsp; &nbsp;db1.tab1_2</span></font></div><div style="line-height: 22px;"><br style="line-height: 22px;"></div><div style="line-height: 22px;"><font size="2" style="line-height: 19px;"><br style="line-height: 19px;"></font></div><div style="line-height: 22px;"><font size="2" style="line-height: 19px;"><span class="pun">重新执行</span><span class="pln">checksum</span><span class="pun">，可以看到数据已经同步过来了。</span></font></div><div style="line-height: 22px;"><font size="2" style="line-height: 19px;"><span class="pln">&nbsp;SELECT db</span><span class="pun">,</span><span class="pln"> tbl</span><span class="pun">,</span><span class="pln">lower_boundary</span><span class="pun">,</span><span class="pln">upper_boundary</span><span class="pun">,</span><span class="pln"> this_cnt</span><span class="pun">,</span><span class="pln">master_cnt</span><span class="pun">,</span><span class="pln">this_crc</span><span class="pun">,</span><span class="pln">master_crc</span><span class="pun">,</span><span class="pln">ts FROM test</span><span class="pun">.</span><span class="pln">checksums </span><span class="pun">;</span></font></div><div style="line-height: 22px;"><font size="2" style="line-height: 19px;"><span class="pun">+-----+--------+----------------+----------------+----------+------------+----------+------------+---------------------+</span></font></div><div style="line-height: 22px;"><font size="2" style="line-height: 19px;"><span class="pun">|</span><span class="pln"> db &nbsp;</span><span class="pun">|</span><span class="pln"> tbl &nbsp; &nbsp;</span><span class="pun">|</span><span class="pln"> lower_boundary </span><span class="pun">|</span><span class="pln"> upper_boundary </span><span class="pun">|</span><span class="pln"> this_cnt </span><span class="pun">|</span><span class="pln"> master_cnt </span><span class="pun">|</span><span class="pln"> this_crc </span><span class="pun">|</span><span class="pln"> master_crc </span><span class="pun">|</span><span class="pln"> ts &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">|</span></font></div><div style="line-height: 22px;"><font size="2" style="line-height: 19px;"><span class="pun">+-----+--------+----------------+----------------+----------+------------+----------+------------+---------------------+</span></font></div><div style="line-height: 22px;"><font size="2" style="line-height: 19px;"><span class="pun">|</span><span class="pln"> db1 </span><span class="pun">|</span><span class="pln"> tab1_1 </span><span class="pun">|</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">|</span><span class="pln"> </span><span class="lit">999</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">|</span><span class="pln"> &nbsp; &nbsp; </span><span class="lit">1000</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> &nbsp; &nbsp; &nbsp; </span><span class="lit">1000</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> dbd114dd </span><span class="pun">|</span><span class="pln"> dbd114dd &nbsp; </span><span class="pun">|</span><span class="pln"> </span><span class="lit">2013</span><span class="pun">-</span><span class="lit">06</span><span class="pun">-</span><span class="lit">25</span><span class="pln"> </span><span class="lit">14</span><span class="pun">:</span><span class="lit">06</span><span class="pun">:</span><span class="lit">38</span><span class="pln"> </span><span class="pun">|</span></font></div><div style="line-height: 22px;"><font size="2" style="line-height: 19px;"><span class="pun">|</span><span class="pln"> db1 </span><span class="pun">|</span><span class="pln"> tab1_1 </span><span class="pun">|</span><span class="pln"> </span><span class="lit">1000</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">|</span><span class="pln"> </span><span class="lit">9999</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">|</span><span class="pln"> &nbsp; &nbsp; </span><span class="lit">9000</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> &nbsp; &nbsp; &nbsp; </span><span class="lit">9000</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">|</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">|</span><span class="pln"> </span><span class="lit">2013</span><span class="pun">-</span><span class="lit">06</span><span class="pun">-</span><span class="lit">25</span><span class="pln"> </span><span class="lit">14</span><span class="pun">:</span><span class="lit">06</span><span class="pun">:</span><span class="lit">38</span><span class="pln"> </span><span class="pun">|</span></font></div><div style="line-height: 22px;"><font size="2" style="line-height: 19px;"><span class="pun">|</span><span class="pln"> db1 </span><span class="pun">|</span><span class="pln"> tab1_1 </span><span class="pun">|</span><span class="pln"> NULL &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">|</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">|</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="lit">0</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="lit">0</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">|</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">|</span><span class="pln"> </span><span class="lit">2013</span><span class="pun">-</span><span class="lit">06</span><span class="pun">-</span><span class="lit">25</span><span class="pln"> </span><span class="lit">14</span><span class="pun">:</span><span class="lit">06</span><span class="pun">:</span><span class="lit">38</span><span class="pln"> </span><span class="pun">|</span></font></div><div style="line-height: 22px;"><font size="2" style="line-height: 19px;"><span class="pun">|</span><span class="pln"> db1 </span><span class="pun">|</span><span class="pln"> tab1_1 </span><span class="pun">|</span><span class="pln"> </span><span class="lit">9999</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">|</span><span class="pln"> NULL &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">|</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="lit">0</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="lit">0</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">|</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">|</span><span class="pln"> </span><span class="lit">2013</span><span class="pun">-</span><span class="lit">06</span><span class="pun">-</span><span class="lit">25</span><span class="pln"> </span><span class="lit">14</span><span class="pun">:</span><span class="lit">06</span><span class="pun">:</span><span class="lit">38</span><span class="pln"> </span><span class="pun">|</span></font></div><div style="line-height: 22px;"><font size="2" style="line-height: 19px;"><span class="pun">|</span><span class="pln"> db1 </span><span class="pun">|</span><span class="pln"> tab1_2 </span><span class="pun">|</span><span class="pln"> NULL &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">|</span><span class="pln"> NULL &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">|</span><span class="pln"> &nbsp; &nbsp; </span><span class="lit">1000</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> &nbsp; &nbsp; &nbsp; </span><span class="lit">1000</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> dbd114dd </span><span class="pun">|</span><span class="pln"> dbd114dd &nbsp; </span><span class="pun">|</span><span class="pln"> </span><span class="lit">2013</span><span class="pun">-</span><span class="lit">06</span><span class="pun">-</span><span class="lit">25</span><span class="pln"> </span><span class="lit">14</span><span class="pun">:</span><span class="lit">06</span><span class="pun">:</span><span class="lit">38</span><span class="pln"> </span><span class="pun">|</span></font></div><div style="line-height: 22px;"><font size="2" style="line-height: 19px;"><span class="pun">+-----+--------+----------------+----------------+----------+------------+----------+------------+---------------------+</span></font></div></pre></div><div><font size="2"><br></font></div><div><pre class="prettyprint" style="line-height: 22px;"><div style="line-height: 22px;"><font size="2" style="line-height: 19px;"><span class="pun">常用的参数解释</span></font></div><div style="line-height: 22px;"><font size="2" style="line-height: 19px;"><br style="line-height: 19px;"></font></div><div style="line-height: 22px;"><font size="2" style="line-height: 19px;"><span class="pun">--</span><span class="pln">sync</span><span class="pun">-</span><span class="pln">to</span><span class="pun">-</span><span class="pln">master </span><span class="pun">将数据和</span><span class="pln">master</span><span class="pun">上保持一致</span></font></div><div style="line-height: 22px;"><font size="2" style="line-height: 19px;"><span class="pun">--</span><span class="pln">dry</span><span class="pun">-</span><span class="pln">run </span><span class="pun">干跑</span><span class="pln"> </span><span class="pun">不实际执行</span></font></div><div style="line-height: 22px;"><font size="2" style="line-height: 19px;"><span class="pun">--</span><span class="pln">execute </span><span class="pun">执行执行</span></font></div><div style="line-height: 22px;"><font size="2" style="line-height: 19px;"><span class="pun">--</span><span class="pln">bin</span><span class="pun">-</span><span class="pln">log </span><span class="pun">记录</span><span class="pln">binlog</span></font></div><div style="line-height: 22px;"><font size="2" style="line-height: 19px;"><span class="pun">--</span><span class="pln">replicate</span></font></div></pre></div><div><font size="2"><br></font></div><div><pre class="prettyprint" style="line-height: 22px;"><div style="line-height: 22px;"><font size="2" style="line-height: 19px;"><span class="pun">常见的错误及其解决方法</span></font></div><div style="line-height: 22px;"><font size="2" style="line-height: 19px;"><span class="pun">[</span><span class="pln">root@centos</span><span class="pun">-</span><span class="lit">0</span><span class="pln"> bin</span><span class="pun">]</span><span class="com"># ./pt-table-sync --execute &nbsp;h='127.0.0.1',u='root',p='dh123',P=5331,D=db1,t=tab1_1 &nbsp;h='192.168.12.201',u='root',p='dh123',P=5331</span></font></div><div style="line-height: 22px;"><font size="2" style="line-height: 19px;"><span class="com">Can't make changes on D=db1,P=5331,h=192.168.12.201,p=...,t=tab1_1,u=root because it's a slave. See the documentation section 'REPLICATION SAFETY' for solutions to this problem. at ./pt-table-sync line 10612. &nbsp;while doing db1.tab1_1 on 192.168.12.201</span></font></div><div style="line-height: 22px;"><font size="2" style="line-height: 19px;"><br style="line-height: 19px;"></font></div><div style="line-height: 22px;"><font size="2" style="line-height: 19px;"><span class="pun">两个实例是复制关系</span><span class="pln"> </span><span class="pun">，为了保证数据的安全性，而报的错</span></font></div></pre></div><p></p></div><wbr></div>